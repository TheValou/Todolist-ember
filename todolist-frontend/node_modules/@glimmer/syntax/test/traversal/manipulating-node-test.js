'use strict';

var _support = require('../support');

var _syntax = require('@glimmer/syntax');

QUnit.module('[glimmer-syntax] Traversal - manipulating');
['enter', 'exit'].forEach(eventName => {
    QUnit.test(`[${eventName}] Replacing self in a key (returning null)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName]: node => {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return null;
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an empty array)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotRemoveNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `<x y={{a}} />`);
    });
    QUnit.test(`[${eventName}] Replacing self in a key (returning an array with multiple nodes)`, assert => {
        let ast = (0, _syntax.preprocess)(`<x y={{z}} />`);
        let el = ast.body[0];
        let attr = el.attributes[0];
        assert.throws(() => {
            (0, _syntax.traverse)(ast, {
                MustacheStatement: {
                    [eventName](node) {
                        if (node.path.type === 'PathExpression' && node.path.parts[0] === 'z') {
                            return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                        }
                        return;
                    }
                }
            });
        }, (0, _syntax.cannotReplaceNode)(attr.value, attr, 'value'));
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning null)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return null;
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an empty array)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning a node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return _syntax.builders.mustache('a');
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with a single node)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{z}}`);
    });
    QUnit.test(`[${eventName}] Replacing self in an array (returning an array with multiple nodes)`, () => {
        let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
        (0, _syntax.traverse)(ast, {
            MustacheStatement: {
                [eventName](node) {
                    if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                        return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
                    }
                    return;
                }
            }
        });
        (0, _support.astEqual)(ast, `{{x}}{{a}}{{b}}{{c}}{{z}}`);
    });
});
QUnit.module('[glimmer-syntax] Traversal - manipulating (edge cases)');
QUnit.test('Inside of a block', () => {
    let ast = (0, _syntax.preprocess)(`{{y}}{{#w}}{{x}}{{y}}{{z}}{{/w}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement(node) {
            if (node.path.type === 'PathExpression' && node.path.parts[0] === 'y') {
                return [_syntax.builders.mustache('a'), _syntax.builders.mustache('b'), _syntax.builders.mustache('c')];
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{a}}{{b}}{{c}}{{#w}}{{x}}{{a}}{{b}}{{c}}{{z}}{{/w}}`);
});
QUnit.test('Should recurrsively walk the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{x}}{{y}}{{z}}`);
    (0, _syntax.traverse)(ast, {
        MustacheStatement: function (node) {
            if (node.path.original === 'x') {
                return _syntax.builders.mustache('y');
            } else if (node.path.original === 'y') {
                return _syntax.builders.mustache('z');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{z}}{{z}}{{z}}`);
});
QUnit.test('Should recurrsively walk the keys in the transformed node', () => {
    let ast = (0, _syntax.preprocess)(`{{#foo}}{{#bar}}{{baz}}{{/bar}}{{else}}{{#bar}}{{bat}}{{/bar}}{{/foo}}`);
    (0, _syntax.traverse)(ast, {
        BlockStatement: function (node) {
            if (node.path.original === 'foo') {
                return _syntax.builders.block(_syntax.builders.path('x-foo'), node.params, node.hash, node.program, node.inverse, node.loc);
            } else if (node.path.original === 'bar') {
                return _syntax.builders.block(_syntax.builders.path('x-bar'), node.params, node.hash, node.program, node.inverse, node.loc);
            }
            return;
        },
        MustacheStatement: function (node) {
            if (node.path.original === 'baz') {
                return _syntax.builders.mustache('x-baz');
            } else if (node.path.original === 'bat') {
                return _syntax.builders.mustache('x-bat');
            }
            return;
        }
    });
    (0, _support.astEqual)(ast, `{{#x-foo}}{{#x-bar}}{{x-baz}}{{/x-bar}}{{else}}{{#x-bar}}{{x-bat}}{{/x-bar}}{{/x-foo}}`);
});
QUnit.test('Exit event is not triggered if the node is replaced during the enter event', assert => {
    let ast = (0, _syntax.preprocess)(`{{x}}`);
    let entered = [];
    let exited = [];
    (0, _syntax.traverse)(ast, {
        MustacheStatement: {
            enter(node) {
                entered.push(node.path.original);
                return _syntax.builders.mustache('y');
            },
            exit(node) {
                exited.push(node.path.original);
            }
        }
    });
    assert.deepEqual(entered, ['x', 'y']);
    assert.deepEqual(exited, ['y']);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuaXB1bGF0aW5nLW5vZGUtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL3N5bnRheC90ZXN0L3RyYXZlcnNhbC9tYW5pcHVsYXRpbmctbm9kZS10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsQUFBTyxBQUFFLEFBQVEsQUFBRSxBQUFNLEFBQVksQUFBQzs7QUFDdEMsQUFBTyxBQUNMLEFBQVUsQUFBSSxBQUFLLEFBQ25CLEFBQVEsQUFDUixBQUFRLEFBQUksQUFBQyxBQUViLEFBQWdCLEFBQ2hCLEFBQWlCLEFBQ2xCLEFBQU0sQUFBaUIsQUFBQzs7QUFFekIsQUFBSyxNQUFDLEFBQU0sT0FBQyxBQUEyQyxBQUFDLEFBQUM7QUFFekQsQ0FBQyxBQUFPLFNBQUUsQUFBTSxBQUE2QixRQUFDLEFBQU8sUUFBQyxBQUFTLEFBQUMsQUFBRTtBQUNqRSxBQUFLLFVBQUMsQUFBSSxBQUFDLFNBQUksQUFBUyxTQUE0Qyw4Q0FBRSxBQUFNLEFBQUMsQUFBRTtBQUM3RSxZQUFJLEFBQUcsTUFBRyxBQUFLLEFBQUMsd0JBQWUsQUFBQyxBQUFDO0FBQ2pDLFlBQUksQUFBRSxLQUFHLEFBQUcsSUFBQyxBQUFJLEtBQUMsQUFBQyxBQUFvQixBQUFDO0FBQ3hDLFlBQUksQUFBSSxPQUFHLEFBQUUsR0FBQyxBQUFVLFdBQUMsQUFBQyxBQUFDLEFBQUM7QUFFNUIsQUFBTSxlQUFDLEFBQU0sT0FBQyxBQUFHLEFBQUU7QUFDakIsQUFBUSxrQ0FBQyxBQUFHO0FBQ1YsQUFBaUI7QUFDZixxQkFBQyxBQUFTLEFBQUMsWUFBRyxBQUEyQixBQUFFLEFBQUUsSUFBaEM7QUFDWCw0QkFBSSxBQUFJLEtBQUMsQUFBSSxLQUFDLEFBQUksU0FBSyxBQUFnQixvQkFBSSxBQUFJLEtBQUMsQUFBSSxLQUFDLEFBQUssTUFBQyxBQUFDLEFBQUMsT0FBSyxBQUFHLEtBQUU7QUFDckUsbUNBQU8sQUFB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QUMsQUFBRyxBQUFDLEFBQUMsQUFBQyxBQUNsQztBQUFDLEFBQUMsQUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzdEVxdWFsIH0gZnJvbSAnLi4vc3VwcG9ydCc7XG5pbXBvcnQge1xuICBwcmVwcm9jZXNzIGFzIHBhcnNlLFxuICB0cmF2ZXJzZSxcbiAgYnVpbGRlcnMgYXMgYixcbiAgQVNULFxuICBjYW5ub3RSZW1vdmVOb2RlLFxuICBjYW5ub3RSZXBsYWNlTm9kZSxcbn0gZnJvbSAnQGdsaW1tZXIvc3ludGF4JztcblxuUVVuaXQubW9kdWxlKCdbZ2xpbW1lci1zeW50YXhdIFRyYXZlcnNhbCAtIG1hbmlwdWxhdGluZycpO1xuXG4oWydlbnRlcicsICdleGl0J10gYXMgQXJyYXk8J2VudGVyJyB8ICdleGl0Jz4pLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBudWxsKWAsIGFzc2VydCA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGA8eCB5PXt7en19IC8+YCk7XG4gICAgbGV0IGVsID0gYXN0LmJvZHlbMF0gYXMgQVNULkVsZW1lbnROb2RlO1xuICAgIGxldCBhdHRyID0gZWwuYXR0cmlidXRlc1swXTtcblxuICAgIGFzc2VydC50aHJvd3MoKCkgPT4ge1xuICAgICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgW2V2ZW50TmFtZV06IChub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSwgY2Fubm90UmVtb3ZlTm9kZShhdHRyLnZhbHVlLCBhdHRyLCAndmFsdWUnKSk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYW4gZW1wdHkgYXJyYXkpYCwgYXNzZXJ0ID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICBsZXQgZWwgPSBhc3QuYm9keVswXSBhcyBBU1QuRWxlbWVudE5vZGU7XG4gICAgbGV0IGF0dHIgPSBlbC5hdHRyaWJ1dGVzWzBdO1xuXG4gICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0sIGNhbm5vdFJlbW92ZU5vZGUoYXR0ci52YWx1ZSwgYXR0ciwgJ3ZhbHVlJykpO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGEgbm9kZSlgLCAoKSA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGA8eCB5PXt7en19IC8+YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ2EnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGFzdEVxdWFsKGFzdCwgYDx4IHk9e3thfX0gLz5gKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChcbiAgICBgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBhbiBhcnJheSB3aXRoIGEgc2luZ2xlIG5vZGUpYCxcbiAgICAoKSA9PiB7XG4gICAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcblxuICAgICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgICBpZiAobm9kZS5wYXRoLnR5cGUgPT09ICdQYXRoRXhwcmVzc2lvbicgJiYgbm9kZS5wYXRoLnBhcnRzWzBdID09PSAneicpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgYXN0RXF1YWwoYXN0LCBgPHggeT17e2F9fSAvPmApO1xuICAgIH1cbiAgKTtcblxuICBRVW5pdC50ZXN0KFxuICAgIGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggbXVsdGlwbGUgbm9kZXMpYCxcbiAgICBhc3NlcnQgPT4ge1xuICAgICAgbGV0IGFzdCA9IHBhcnNlKGA8eCB5PXt7en19IC8+YCk7XG4gICAgICBsZXQgZWwgPSBhc3QuYm9keVswXSBhcyBBU1QuRWxlbWVudE5vZGU7XG4gICAgICBsZXQgYXR0ciA9IGVsLmF0dHJpYnV0ZXNbMF07XG5cbiAgICAgIGFzc2VydC50aHJvd3MoKCkgPT4ge1xuICAgICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgICAgW2V2ZW50TmFtZV0obm9kZTogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpLCBiLm11c3RhY2hlKCdiJyksIGIubXVzdGFjaGUoJ2MnKV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0sIGNhbm5vdFJlcGxhY2VOb2RlKGF0dHIudmFsdWUsIGF0dHIsICd2YWx1ZScpKTtcbiAgICB9XG4gICk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYW4gYXJyYXkgKHJldHVybmluZyBudWxsKWAsICgpID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYHt7eH19e3t5fX17e3p9fWApO1xuXG4gICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnR5cGUgPT09ICdQYXRoRXhwcmVzc2lvbicgJiYgbm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e3p9fWApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGFuIGVtcHR5IGFycmF5KWAsICgpID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYHt7eH19e3t5fX17e3p9fWApO1xuXG4gICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnR5cGUgPT09ICdQYXRoRXhwcmVzc2lvbicgJiYgbm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGFzdEVxdWFsKGFzdCwgYHt7eH19e3t6fX1gKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYW4gYXJyYXkgKHJldHVybmluZyBhIG5vZGUpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ2EnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGFzdEVxdWFsKGFzdCwgYHt7eH19e3thfX17e3p9fWApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KFxuICAgIGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggYSBzaW5nbGUgbm9kZSlgLFxuICAgICgpID0+IHtcbiAgICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC50eXBlID09PSAnUGF0aEV4cHJlc3Npb24nICYmIG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGFzdEVxdWFsKGFzdCwgYHt7eH19e3thfX17e3p9fWApO1xuICAgIH1cbiAgKTtcblxuICBRVW5pdC50ZXN0KFxuICAgIGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggbXVsdGlwbGUgbm9kZXMpYCxcbiAgICAoKSA9PiB7XG4gICAgICBsZXQgYXN0ID0gcGFyc2UoYHt7eH19e3t5fX17e3p9fWApO1xuXG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXShub2RlOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgICByZXR1cm4gW2IubXVzdGFjaGUoJ2EnKSwgYi5tdXN0YWNoZSgnYicpLCBiLm11c3RhY2hlKCdjJyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgYXN0RXF1YWwoYXN0LCBge3t4fX17e2F9fXt7Yn19e3tjfX17e3p9fWApO1xuICAgIH1cbiAgKTtcbn0pO1xuXG5RVW5pdC5tb2R1bGUoJ1tnbGltbWVyLXN5bnRheF0gVHJhdmVyc2FsIC0gbWFuaXB1bGF0aW5nIChlZGdlIGNhc2VzKScpO1xuXG5RVW5pdC50ZXN0KCdJbnNpZGUgb2YgYSBibG9jaycsICgpID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7e3l9fXt7I3d9fXt7eH19e3t5fX17e3p9fXt7L3d9fWApO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIE11c3RhY2hlU3RhdGVtZW50KG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnBhdGgudHlwZSA9PT0gJ1BhdGhFeHByZXNzaW9uJyAmJiBub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICByZXR1cm4gW2IubXVzdGFjaGUoJ2EnKSwgYi5tdXN0YWNoZSgnYicpLCBiLm11c3RhY2hlKCdjJyldO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH0sXG4gIH0pO1xuXG4gIGFzdEVxdWFsKGFzdCwgYHt7YX19e3tifX17e2N9fXt7I3d9fXt7eH19e3thfX17e2J9fXt7Y319e3t6fX17ey93fX1gKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdTaG91bGQgcmVjdXJyc2l2ZWx5IHdhbGsgdGhlIHRyYW5zZm9ybWVkIG5vZGUnLCAoKSA9PiB7XG4gIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICd4Jykge1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneScpO1xuICAgICAgfSBlbHNlIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICd5Jykge1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH0sXG4gIH0pO1xuXG4gIGFzdEVxdWFsKGFzdCwgYHt7en19e3t6fX17e3p9fWApO1xufSk7XG5cblFVbml0LnRlc3QoJ1Nob3VsZCByZWN1cnJzaXZlbHkgd2FsayB0aGUga2V5cyBpbiB0aGUgdHJhbnNmb3JtZWQgbm9kZScsICgpID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7eyNmb299fXt7I2Jhcn19e3tiYXp9fXt7L2Jhcn19e3tlbHNlfX17eyNiYXJ9fXt7YmF0fX17ey9iYXJ9fXt7L2Zvb319YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgQmxvY2tTdGF0ZW1lbnQ6IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICdmb28nKSB7XG4gICAgICAgIHJldHVybiBiLmJsb2NrKFxuICAgICAgICAgIGIucGF0aCgneC1mb28nKSxcbiAgICAgICAgICBub2RlLnBhcmFtcyxcbiAgICAgICAgICBub2RlLmhhc2gsXG4gICAgICAgICAgbm9kZS5wcm9ncmFtLFxuICAgICAgICAgIG5vZGUuaW52ZXJzZSxcbiAgICAgICAgICBub2RlLmxvY1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChub2RlLnBhdGgub3JpZ2luYWwgPT09ICdiYXInKSB7XG4gICAgICAgIHJldHVybiBiLmJsb2NrKFxuICAgICAgICAgIGIucGF0aCgneC1iYXInKSxcbiAgICAgICAgICBub2RlLnBhcmFtcyxcbiAgICAgICAgICBub2RlLmhhc2gsXG4gICAgICAgICAgbm9kZS5wcm9ncmFtLFxuICAgICAgICAgIG5vZGUuaW52ZXJzZSxcbiAgICAgICAgICBub2RlLmxvY1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH0sXG5cbiAgICBNdXN0YWNoZVN0YXRlbWVudDogZnVuY3Rpb24obm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JheicpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF6Jyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JhdCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF0Jyk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfSxcbiAgfSk7XG5cbiAgYXN0RXF1YWwoXG4gICAgYXN0LFxuICAgIGB7eyN4LWZvb319e3sjeC1iYXJ9fXt7eC1iYXp9fXt7L3gtYmFyfX17e2Vsc2V9fXt7I3gtYmFyfX17e3gtYmF0fX17ey94LWJhcn19e3sveC1mb299fWBcbiAgKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdFeGl0IGV2ZW50IGlzIG5vdCB0cmlnZ2VyZWQgaWYgdGhlIG5vZGUgaXMgcmVwbGFjZWQgZHVyaW5nIHRoZSBlbnRlciBldmVudCcsIGFzc2VydCA9PiB7XG4gIGxldCBhc3QgPSBwYXJzZShge3t4fX1gKTtcblxuICBsZXQgZW50ZXJlZDogQXJyYXk8c3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWQ+ID0gW107XG4gIGxldCBleGl0ZWQ6IEFycmF5PHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkPiA9IFtdO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICBlbnRlcihub2RlKSB7XG4gICAgICAgIGVudGVyZWQucHVzaChub2RlLnBhdGgub3JpZ2luYWwpO1xuICAgICAgICByZXR1cm4gYi5tdXN0YWNoZSgneScpO1xuICAgICAgfSxcbiAgICAgIGV4aXQobm9kZSkge1xuICAgICAgICBleGl0ZWQucHVzaChub2RlLnBhdGgub3JpZ2luYWwpO1xuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhc3NlcnQuZGVlcEVxdWFsKGVudGVyZWQsIFsneCcsICd5J10pO1xuICBhc3NlcnQuZGVlcEVxdWFsKGV4aXRlZCwgWyd5J10pO1xufSk7XG4iXX0=